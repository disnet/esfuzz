// Generated by CoffeeScript 2.0.0-beta5
void function () {
  var acorn, BlockStatement, DebuggerStatement, EmptyStatement, escodegen, esprima, expressions, ExpressionStatement, fuzz, Identifier, IfStatement, listOf, maybe, notReserved, Number_, oneOf, parsers, Program, randomElement, randomInt, reflect, render, RESERVED, RoundtripFailureError, statements, String_, SwitchCase, SwitchCaseDefault, SwitchStatement, terminalStatements, toplevelStatements, WithStatement;
  escodegen = require('escodegen');
  esprima = require('esprima');
  acorn = require('acorn');
  reflect = require('reflect');
  RESERVED = [
    'break',
    'case',
    'catch',
    'class',
    'const',
    'continue',
    'debugger',
    'default',
    'delete',
    'do',
    'else',
    'enum',
    'export',
    'extends',
    'finally',
    'for',
    'function',
    'if',
    'import',
    'in',
    'instanceof',
    'new',
    'return',
    'super',
    'switch',
    'this',
    'throw',
    'try',
    'typeof',
    'var',
    'void',
    'while',
    'with',
    'let',
    'yield'
  ];
  RoundtripFailureError = function (super$) {
    extends$(RoundtripFailureError, super$);
    function RoundtripFailureError() {
    }
    ;
    return RoundtripFailureError;
  }(Error);
  if (null != this.setImmediate)
    this.setImmediate;
  else
    this.setImmediate = function (fn) {
      return setTimeout(fn, 0);
    };
  randomInt = function (max) {
    return Math.floor(Math.random() * (max + 1));
  };
  randomElement = function (list) {
    return list[randomInt(list.length - 1)];
  };
  render = function (program) {
    return escodegen.generate(program, { format: escodegen.FORMAT_MINIFY });
  };
  listOf = function (possibleGenerators, probability) {
    if (null == probability)
      probability = .5;
    return function (accum$) {
      while (Math.random() < probability) {
        accum$.push(oneOf(possibleGenerators));
      }
      return accum$;
    }.call(this, []);
  };
  oneOf = function (possibleGenerators) {
    return randomElement(possibleGenerators)();
  };
  maybe = function (generator) {
    if (randomElement([
        true,
        false
      ])) {
      return generator();
    } else {
      return null;
    }
  };
  notReserved = function (generator) {
    var id;
    id = generator();
    id.name = in$(id.name, RESERVED) ? '' + id.name + '_' : id.name;
    return id;
  };
  Program = function () {
    return {
      type: 'Program',
      body: listOf(statements, .8)
    };
  };
  BlockStatement = function () {
    return {
      type: 'BlockStatement',
      body: listOf(statements, .6)
    };
  };
  ExpressionStatement = function () {
    return {
      type: 'ExpressionStatement',
      expression: oneOf(expressions)
    };
  };
  EmptyStatement = function () {
    return { type: 'EmptyStatement' };
  };
  DebuggerStatement = function () {
    return { type: 'DebuggerStatement' };
  };
  IfStatement = function () {
    return {
      type: 'IfStatement',
      test: oneOf(expressions),
      consequent: oneOf(statements),
      alternate: maybe(function () {
        return oneOf(statements);
      })
    };
  };
  WithStatement = function () {
    return {
      type: 'WithStatement',
      object: oneOf(expressions),
      body: oneOf(statements)
    };
  };
  SwitchStatement = function () {
    return {
      type: 'SwitchStatement',
      discriminant: oneOf(expressions),
      cases: listOf([SwitchCase]).concat(oneOf([
        SwitchCaseDefault,
        function () {
          return [];
        }
      ])),
      lexical: false
    };
  };
  SwitchCase = function () {
    return {
      type: 'SwitchCase',
      test: oneOf(expressions),
      consequent: [oneOf(statements)].concat(listOf(statements, .2))
    };
  };
  SwitchCaseDefault = function () {
    return {
      type: 'SwitchCase',
      test: null,
      consequent: [oneOf(statements)].concat(listOf(statements, .2))
    };
  };
  Identifier = function () {
    var identifierPart, identifierStart;
    identifierStart = identifierPart = function () {
      return String.fromCharCode(97 + randomInt(25));
    };
    return {
      type: 'Identifier',
      name: [identifierStart()].concat([].slice.call(function (accum$) {
        while (Math.random() < .8) {
          accum$.push(identifierPart());
        }
        return accum$;
      }.call(this, []))).join('')
    };
  };
  Number_ = function () {
    return oneOf([
      function () {
        return {
          type: 'Literal',
          value: 0
        };
      },
      function () {
        return {
          type: 'Literal',
          value: 0,
          raw: '0.'
        };
      },
      function () {
        return {
          type: 'Literal',
          value: 0,
          raw: '.0'
        };
      },
      function () {
        var int;
        int = randomInt(Math.pow(2, 53) - 1);
        return {
          type: 'Literal',
          value: int,
          raw: function () {
            switch (randomInt(10)) {
            case 0:
              return '' + randomElement([
                '0',
                '00',
                '000',
                '0000'
              ]) + int.toString(8);
            case 1:
              return '0' + randomElement([
                'x',
                'X'
              ]) + int.toString(16);
            default:
              return int.toString();
            }
          }.call(this)
        };
      }
    ]);
  };
  String_ = function () {
    var chars;
    chars = function (accum$) {
      while (Math.random() < .95) {
        accum$.push(String.fromCharCode(32 + randomInt(94)));
      }
      return accum$;
    }.call(this, []);
    return {
      type: 'Literal',
      value: chars.join('')
    };
  };
  terminalStatements = [
    ExpressionStatement,
    EmptyStatement,
    DebuggerStatement
  ];
  toplevelStatements = [].slice.call(terminalStatements).concat([
    IfStatement,
    BlockStatement,
    WithStatement,
    SwitchStatement
  ]);
  statements = [].slice.call(toplevelStatements).concat();
  expressions = [
    Number_,
    String_,
    function () {
      return notReserved(Identifier);
    }
  ];
  process.on('SIGINT', function () {
    process.stdout.write('  \n');
    return process.exit(0);
  });
  parsers = [
    esprima,
    acorn
  ];
  if ('undefined' !== typeof Reflect && null != Reflect && 'function' === typeof Reflect.parse)
    parsers.push(Reflect);
  exports.fuzz = fuzz = function (desiredCount, cb) {
    var counter, recur;
    if (arguments.length < 2) {
      cb = desiredCount;
      desiredCount = 1 / 0;
    }
    counter = 0;
    (recur = function () {
      var err, program, programAST, roundTrippedProgram, roundTrippedPrograms, targetProgram;
      ++counter;
      programAST = Program();
      program = escodegen.generate(programAST, {
        verbatim: 'raw',
        format: escodegen.FORMAT_MINIFY
      });
      try {
        roundTrippedPrograms = function (accum$) {
          var parser;
          for (var i$ = 0, length$ = parsers.length; i$ < length$; ++i$) {
            parser = parsers[i$];
            accum$.push(render(parser.parse(program)));
          }
          return accum$;
        }.call(this, []);
      } catch (e$) {
        err = e$;
        err.ast = programAST;
        err.js = program;
        cb(err);
        return;
      }
      process.stdout.write('\b\b\b\b\b\b\b\b\b\b' + counter);
      targetProgram = render(programAST);
      for (var i$ = 0, length$ = roundTrippedPrograms.length; i$ < length$; ++i$) {
        roundTrippedProgram = roundTrippedPrograms[i$];
        if (!(roundTrippedProgram !== targetProgram))
          continue;
        err = new RoundtripFailureError;
        err.ast = programAST;
        err.js = program;
        cb(err);
        return;
      }
      if (counter < desiredCount) {
        setImmediate(recur);
      } else {
        setImmediate(cb);
      }
    })();
  };
  fuzz(1e4, function (err) {
    var ast, cache$, js;
    if (null != err) {
      cache$ = err;
      ast = cache$.ast;
      js = cache$.js;
      console.error('\n' + err.stack + '\n' + js + '\n\n' + JSON.stringify(ast));
      return process.exit(1);
    } else {
      return process.stdout.write('\n');
    }
  });
  function isOwn$(o, p) {
    return {}.hasOwnProperty.call(o, p);
  }
  function extends$(child, parent) {
    for (var key in parent)
      if (isOwn$(parent, key))
        child[key] = parent[key];
    function ctor() {
      this.constructor = child;
    }
    ctor.prototype = parent.prototype;
    child.prototype = new ctor;
    child.__super__ = parent.prototype;
    return child;
  }
  function in$(member, list) {
    for (var i = 0, length = list.length; i < length; ++i)
      if (i in list && list[i] === member)
        return true;
    return false;
  }
}.call(this);
